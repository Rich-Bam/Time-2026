<!DOCTYPE html>
<html lang="nl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <link rel="icon" type="image/png" href="/Bampro_Logo_klein.png" />
    <link rel="manifest" href="/manifest.json" />
    <meta name="theme-color" content="#ea580c" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="BAMPRO Uren" />
    <link rel="apple-touch-icon" href="/Bampro_Logo_klein.png" />
    <title>BAMPRO MARINE - Urenregistratie</title>
    <meta name="description" content="BAMPRO MARINE urenregistratie systeem" />
    <meta name="author" content="BAMPRO MARINE" />

    <meta property="og:title" content="BAMPRO MARINE - Urenregistratie" />
    <meta property="og:description" content="BAMPRO MARINE urenregistratie systeem" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="https://bampro-uren.nl/Bampro_Logo_klein.png" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:image" content="https://bampro-uren.nl/Bampro_Logo_klein.png" />
  </head>

  <body>
    <div id="root"></div>
    <script>
      // Service Worker Cleanup Script
      // This runs BEFORE React loads to unregister old service workers
      // that might be serving cached JavaScript files
      (function() {
        // Only run in production (not localhost)
        if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
          return; // Skip in development
        }

        const CURRENT_VERSION = '2.0.3';
        const VERSION_KEY = 'app-version';
        const storedVersion = localStorage.getItem(VERSION_KEY);
        const urlParams = new URLSearchParams(window.location.search);
        const shouldClear = urlParams.get('clearCache') === 'true' || storedVersion !== CURRENT_VERSION;

        // Always clear cache if version doesn't match OR if explicit request
        // This ensures users always get the latest code after a deployment
        if (!shouldClear) {
          // Version matches, skip cleanup for this version
          return;
        }

        console.log('üßπ Cleaning up old service workers and cache...');

        // Wait for all cleanup operations to complete before reloading
        Promise.all([
          // Unregister all service workers
          ('serviceWorker' in navigator 
            ? navigator.serviceWorker.getRegistrations().then(function(registrations) {
                return Promise.all(registrations.map(function(reg) {
                  return reg.unregister().then(function(success) {
                    if (success) console.log('‚úÖ Service worker unregistered');
                    return success;
                  });
                }));
              })
            : Promise.resolve([])),
          // Clear all caches
          ('caches' in window
            ? caches.keys().then(function(names) {
                return Promise.all(names.map(function(name) {
                  return caches.delete(name);
                })).then(function() {
                  console.log('‚úÖ Caches cleared');
                });
              })
            : Promise.resolve())
        ]).then(function() {
          // Update version and clear localStorage (keep language preference)
          var language = localStorage.getItem('language');
          localStorage.clear();
          if (language) {
            localStorage.setItem('language', language);
          }
          localStorage.setItem(VERSION_KEY, CURRENT_VERSION);

          console.log('‚úÖ Cleanup completed, reloading...');

          // Remove clearCache parameter if present and reload
          if (urlParams.has('clearCache')) {
            urlParams.delete('clearCache');
            var newUrl = window.location.pathname + (urlParams.toString() ? '?' + urlParams.toString() : '');
            window.location.replace(newUrl);
          } else {
            // Reload page to get fresh version
            window.location.reload();
          }
        }).catch(function(error) {
          console.error('‚ùå Error during cleanup:', error);
          // Even if cleanup fails, try to reload
          window.location.reload();
        });
      })();
    </script>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
